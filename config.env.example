#!/bin/bash
# =============================================================================
# MARZBAN VPN INSTALLER - CONFIGURATION FILE
# =============================================================================
# Copy this file to config.env and fill in your values:
#   cp config.env.example config.env
#   nano config.env
#
# Required fields are marked with [REQUIRED]
# Optional fields have default values that work for most setups
# =============================================================================

# -----------------------------------------------------------------------------
# DOMAIN CONFIGURATION [REQUIRED]
# -----------------------------------------------------------------------------

# Your main domain for Marzban panel
# Example: panel.example.com
# Make sure DNS A record points to your server IP BEFORE running installer
PANEL_DOMAIN=""

# Subdomain for subscription links (can be same as panel or different)
# Example: sub.example.com or same as PANEL_DOMAIN
SUB_DOMAIN=""

# Email for Let's Encrypt SSL certificates
# You'll receive expiration notifications at this email
SSL_EMAIL=""

# -----------------------------------------------------------------------------
# PANEL CONFIGURATION
# -----------------------------------------------------------------------------

# Marzban admin username
# Default: admin
MARZBAN_ADMIN_USER="admin"

# Marzban admin password
# Leave empty to auto-generate a secure 24-character password
# The generated password will be saved to /opt/marzban/admin_credentials.txt
MARZBAN_ADMIN_PASS=""

# Marzban panel port (HTTPS)
# Default: 8443 (recommended to avoid conflicts with VPN on 443)
MARZBAN_PORT="8443"

# -----------------------------------------------------------------------------
# ADGUARD HOME CONFIGURATION
# -----------------------------------------------------------------------------

# AdGuard Home web interface port
# Default: 3000
ADGUARD_WEB_PORT="3000"

# AdGuard DNS port (internal, used by Marzban for DNS resolution)
# Default: 53
# Note: systemd-resolved will be disabled if it's using port 53
ADGUARD_DNS_PORT="53"

# AdGuard Home admin username
# Default: admin
ADGUARD_USER="admin"

# AdGuard Home admin password
# Leave empty to auto-generate a secure password
ADGUARD_PASS=""

# -----------------------------------------------------------------------------
# VPN PROFILES CONFIGURATION
# -----------------------------------------------------------------------------
# Three profiles are created by default:
# 1. Whitelist Bypass - Uses port 443 for maximum compatibility
# 2. Standard Fast - Direct connection with different SNI
# 3. Via WARP - Routes through Cloudflare WARP for geo-unblocking
#
# SNI (Server Name Indication) should be a popular, unblocked website
# that supports TLS 1.3. The SNI is used for Reality protocol camouflage.
# -----------------------------------------------------------------------------

# Profile 1: Whitelist Bypass (port 443 for mobile carrier compatibility)
PROFILE1_PORT="443"
PROFILE1_SNI="www.vk.com"
PROFILE1_NAME="Whitelist-VK"

# Profile 2: Standard Fast (direct connection)
PROFILE2_PORT="8444"
PROFILE2_SNI="www.microsoft.com"
PROFILE2_NAME="Standard-Fast"

# Profile 3: Via WARP (for geo-blocked content like Netflix, Spotify)
PROFILE3_PORT="2053"
PROFILE3_SNI="dl.google.com"
PROFILE3_NAME="Via-WARP"

# -----------------------------------------------------------------------------
# ADVANCED OPTIONS
# -----------------------------------------------------------------------------
# Usually no need to change these unless you know what you're doing

# Docker network name
# Default: marzban-network
DOCKER_NETWORK="marzban-network"

# Data directory for all Marzban files
# Default: /opt/marzban
DATA_DIR="/opt/marzban"

# Server timezone
# Default: Europe/Amsterdam
# Use: timedatectl list-timezones to see available options
TZ="Europe/Amsterdam"

# Enable debug mode (more verbose output)
# Default: false
DEBUG_MODE="false"

# -----------------------------------------------------------------------------
# NOTES
# -----------------------------------------------------------------------------
# 
# 1. DOMAIN SETUP (do this BEFORE running the installer):
#    - Create an A record: panel.example.com -> YOUR_SERVER_IP
#    - Wait for DNS propagation (can take up to 24h, usually 5-15 min)
#    - Verify: dig panel.example.com or nslookup panel.example.com
#
# 2. FIREWALL:
#    - The installer will configure UFW firewall automatically
#    - SSH port is auto-detected and always allowed
#    - Make sure your cloud provider's firewall allows the ports too
#
# 3. AFTER INSTALLATION:
#    - Panel: https://PANEL_DOMAIN:8443/dashboard
#    - AdGuard: http://SERVER_IP:3000
#    - Credentials saved in: /opt/marzban/admin_credentials.txt
#
# 4. CLIENT CONFIGURATION:
#    - Reality Public Key: stored in /opt/marzban/keys/reality_keys.env
#    - Add users through Marzban panel
#    - Use v2rayN, v2rayNG, Nekoray, or similar clients
#
# 5. TROUBLESHOOTING:
#    - Check logs: docker logs marzban
#    - Installation log: /var/log/marzban-installer.log
#    - Service status: docker ps
#
# =============================================================================
