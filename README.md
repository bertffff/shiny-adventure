# shiny-adventure

# Marzban VPN Server Installer

–ú–æ–¥—É–ª—å–Ω—ã–π Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ VPN-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –±–∞–∑–µ –ø–∞–Ω–µ–ª–∏ **Marzban** —Å —è–¥—Ä–æ–º **Xray/Sing-box**.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü–∞—Ç—Ç–µ—Ä–Ω Try/Catch —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç–∫–∞—Ç–æ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- üì¶ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- üîê **Reality Protocol**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π X25519
- üåê **WARP Integration**: –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Cloudflare WARP –≤ Sing-box
- üõ°Ô∏è **AdGuard Home**: DNS-—Ä–µ–∑–æ–ª–≤–µ—Ä —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Ä–µ–∫–ª–∞–º—ã
- üî• **UFW**: –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ SSH-–ø–æ—Ä—Ç–∞ –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ñ–∞–π—Ä–≤–æ–ª–∞
- üìú **SSL**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ubuntu 22.04 LTS (–∏–ª–∏ Debian 11+)
- Root-–¥–æ—Å—Ç—É–ø
- –ú–∏–Ω–∏–º—É–º 1GB RAM
- –ú–∏–Ω–∏–º—É–º 5GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- –î–æ–º–µ–Ω, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
marzban-installer/
‚îú‚îÄ‚îÄ install.sh              # –ì–ª–∞–≤–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
‚îú‚îÄ‚îÄ uninstall.sh            # –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config.env.example      # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ core.sh             # –Ø–¥—Ä–æ: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, rollback, —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ docker.sh           # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
‚îÇ   ‚îú‚îÄ‚îÄ firewall.sh         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UFW
‚îÇ   ‚îú‚îÄ‚îÄ ssl.sh              # SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
‚îÇ   ‚îú‚îÄ‚îÄ reality.sh          # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π Reality
‚îÇ   ‚îú‚îÄ‚îÄ warp.sh             # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare WARP
‚îÇ   ‚îú‚îÄ‚îÄ adguard.sh          # AdGuard Home DNS
‚îÇ   ‚îú‚îÄ‚îÄ marzban.sh          # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Marzban
‚îÇ   ‚îî‚îÄ‚îÄ marzban_api.sh      # API –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ inbounds
‚îú‚îÄ‚îÄ configs/                # (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)
‚îî‚îÄ‚îÄ templates/              # (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞

```bash
# –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
cd /root
# –†–∞—Å–ø–∞–∫—É–π—Ç–µ marzban-installer
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
cd marzban-installer
cp config.env.example config.env
nano config.env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `PANEL_DOMAIN` - –¥–æ–º–µ–Ω –¥–ª—è –ø–∞–Ω–µ–ª–∏ Marzban
- `SUB_DOMAIN` - –¥–æ–º–µ–Ω –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ (–º–æ–∂–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å PANEL_DOMAIN)
- `SSL_EMAIL` - email –¥–ª—è Let's Encrypt

### 3. –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
chmod +x install.sh
sudo ./install.sh
```

## –ü—Ä–æ—Ñ–∏–ª–∏ VPN

### –ü—Ä–æ—Ñ–∏–ª—å 1: "Whitelist Bypass"
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ—Å—Ç—É–ø –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤ –†–§ —Ä–µ—Å—É—Ä—Å–∞–º —á–µ—Ä–µ–∑ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫
- **–ü–æ—Ä—Ç**: 443 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤)
- **SNI**: www.vk.com (–º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥ –í–ö)
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: VLESS + TCP + TLS + Reality + Vision
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: Direct

### –ü—Ä–æ—Ñ–∏–ª—å 2: "Standard Fast"
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –æ–±—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ü–æ—Ä—Ç**: 8444
- **SNI**: www.microsoft.com
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: VLESS + TCP + TLS + Reality + Vision
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: Direct

### –ü—Ä–æ—Ñ–∏–ª—å 3: "Via WARP"
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ö–æ–¥ –≥–µ–æ–±–ª–æ–∫–æ–≤ (Netflix, Spotify –∏ —Ç.–¥.)
- **–ü–æ—Ä—Ç**: 2053
- **SNI**: dl.google.com
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: VLESS + TCP + TLS + Reality + Vision
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: –ß–µ—Ä–µ–∑ Cloudflare WARP

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config.env

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
PANEL_DOMAIN="panel.example.com"
SUB_DOMAIN="sub.example.com"
SSL_EMAIL="admin@example.com"

# –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—É—Å—Ç—ã–µ = –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
MARZBAN_ADMIN_USER="admin"
MARZBAN_ADMIN_PASS=""
ADGUARD_USER="admin"
ADGUARD_PASS=""

# –ü–æ—Ä—Ç—ã
MARZBAN_PORT="8443"
ADGUARD_WEB_PORT="3000"

# –ü—Ä–æ—Ñ–∏–ª–∏ VPN
PROFILE1_PORT="443"
PROFILE1_SNI="www.vk.com"
PROFILE2_PORT="8444"
PROFILE2_SNI="www.microsoft.com"
PROFILE3_PORT="2053"
PROFILE3_SNI="dl.google.com"
```

## –§–∞–π–ª—ã –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```
/opt/marzban/
‚îú‚îÄ‚îÄ .env                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Marzban
‚îú‚îÄ‚îÄ docker-compose.yml          # Docker Compose
‚îú‚îÄ‚îÄ admin_credentials.txt       # –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞
‚îú‚îÄ‚îÄ installation_summary.txt    # –°–≤–æ–¥–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ ssl/                        # SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ panel.example.com.crt
‚îÇ   ‚îî‚îÄ‚îÄ panel.example.com.key
‚îú‚îÄ‚îÄ keys/
‚îÇ   ‚îî‚îÄ‚îÄ reality_keys.env        # –ö–ª—é—á–∏ Reality
‚îú‚îÄ‚îÄ warp/
‚îÇ   ‚îú‚îÄ‚îÄ warp.conf               # –ö–æ–Ω—Ñ–∏–≥ WireGuard
‚îÇ   ‚îî‚îÄ‚îÄ warp_outbound.json      # Outbound –¥–ª—è Sing-box
‚îú‚îÄ‚îÄ adguard/
‚îÇ   ‚îú‚îÄ‚îÄ conf/
‚îÇ   ‚îî‚îÄ‚îÄ work/
‚îú‚îÄ‚îÄ logs/
‚îî‚îÄ‚îÄ xray_config.json            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Xray
```

## –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞—Ç–∞ (Rollback)

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –≤–æ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞:

1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
2. –£–¥–∞–ª—è—é—Ç—Å—è —Å–æ–∑–¥–∞–Ω–Ω—ã–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
3. –£–¥–∞–ª—è—é—Ç—Å—è —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
4. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é "–ø–æ–ª—É—Ä–∞–±–æ—á–µ–≥–æ" —Å–µ—Ä–≤–µ—Ä–∞.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ùå –ù–∏–∫–∞–∫–∏—Ö `chmod 777`
- ‚ùå –ù–∏–∫–∞–∫–∏—Ö `docker stop $(docker ps -q)`
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ SSH-–ø–æ—Ä—Ç–∞ –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π UFW
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–∏—Ö –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ Bcrypt-—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π AdGuard
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º (0600 –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤)

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞

```bash
cd /opt/marzban
docker compose ps
docker compose logs -f marzban
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
cd /opt/marzban
docker compose restart
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
cd /opt/marzban
docker compose pull
docker compose up -d
```

### –£–¥–∞–ª–µ–Ω–∏–µ

```bash
sudo ./uninstall.sh
```

## FAQ

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á Reality –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞?

–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏ Short ID —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `/opt/marzban/keys/reality_keys.env`
- `/opt/marzban/installation_summary.txt`

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å SNI?

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/opt/marzban/xray_config.json` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Marzban.

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Marzban: `https://your-domain:8443/dashboard`

### WARP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `/opt/marzban/warp/warp.conf` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WireGuard endpoint –¥–æ—Å—Ç—É–ø–µ–Ω.

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs marzban`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: `/var/log/marzban-installer.log`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã: `ufw status`

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [Marzban](https://github.com/Gozargah/Marzban)
- [Sing-box](https://github.com/SagerNet/sing-box)
- [AdGuard Home](https://github.com/AdguardTeam/AdGuardHome)
- [wgcf](https://github.com/ViRb3/wgcf)
